# 重排规则

规则：最多连续出现k篇某种笔记

- 小红书推荐系统的物品分为图文笔记、视频笔记。
- 最多连续出现k=5篇图文笔记，最多连续出现k=5篇视频笔记。
- 如果排i到i+4的全都是图文笔记，那么排在i+5的必须是视频笔记。

规则：每k篇笔记最多出现1篇某种笔记

- 运营推广笔记的精排分会乘以大于1的系数(boost)帮助笔记获得更多曝光
- 为了防止boost影响体验，限制每k=9篇笔记最多出现1篇运营推广笔记。
- 如果排第i位的是运营推广笔记，那么排i+1到i+8的不能是运营推广笔记。

规则：前t篇笔记最多出现k篇某种笔记

- 排名前t篇笔记最容易被看到，对用户体验最重要。(小红书的top4为首屏)
- 小红书推荐系统有带电商卡片的笔记，过多可能会影响体验。
- 前t=1篇笔记最多出现k=0篇带电商卡片的笔记
- 前t=4篇笔记最多出现k=1篇带电商卡片的笔记

重排结合MMR与规则，在满足规则的前提下最大化MR。
每一轮先用规则排除掉R中的部分物品，得到子集R'。
MMR公式中的R替换成子集R'，选中的物品符合规则。