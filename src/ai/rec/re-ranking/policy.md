# 重排规则

规则：最多连续出现 k 篇某种笔记

- 小红书推荐系统的物品分为图文笔记、视频笔记。
- 最多连续出现 k=5 篇图文笔记，最多连续出现 k=5 篇视频笔记。
- 如果排 i 到 i+4 的全都是图文笔记，那么排在 i+5 的必须是视频笔记。

规则：每 k 篇笔记最多出现 1 篇某种笔记

- 运营推广笔记的精排分会乘以大于 1 的系数(boost)帮助笔记获得更多曝光
- 为了防止 boost 影响体验，限制每 k=9 篇笔记最多出现 1 篇运营推广笔记。
- 如果排第 i 位的是运营推广笔记，那么排 i+1 到 i+8 的不能是运营推广笔记。

规则：前 t 篇笔记最多出现 k 篇某种笔记

- 排名前 t 篇笔记最容易被看到，对用户体验最重要。(小红书的 top4 为首屏)
- 小红书推荐系统有带电商卡片的笔记，过多可能会影响体验。
- 前 t=1 篇笔记最多出现 k=0 篇带电商卡片的笔记
- 前 t=4 篇笔记最多出现 k=1 篇带电商卡片的笔记

重排结合 MMR 与规则，在满足规则的前提下最大化 MR。
每一轮先用规则排除掉 R 中的部分物品，得到子集 R'。
MMR 公式中的 R 替换成子集 R'，选中的物品符合规则。
