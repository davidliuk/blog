# SQL

https://www.w3schools.com/sql/sql_case.asp

练习SQL可以在[网站](https://sqlpad.io/playground/)使用，有现成的一些经典表、数据和代码执行器。

**SQL** 和 **pandas** 是数据分析和处理领域中的两大重要工具，各有优势和局限性。以下是对它们的详细对比：

------

### **1. 数据类型**

| 特性         | SQL                                | pandas                                          |
| ------------ | ---------------------------------- | ----------------------------------------------- |
| **数据来源** | 主要操作关系型数据库中的表。       | 主要操作内存中的 `DataFrame`。                  |
| **数据存储** | 数据通常存储在磁盘（数据库文件）。 | 数据存储在内存中（但可以从文件或数据库读取）。  |
| **数据结构** | 表（行和列的二维结构）。           | `DataFrame`（类似于表）、`Series`（类似于列）。 |

------

### **2. 基本操作**

| 操作类型 | SQL                                     | pandas                                       |
| -------- | --------------------------------------- | -------------------------------------------- |
| **查询** | 使用 `SELECT` 语句查询表中的数据。      | 使用 `df.loc[]` 或 `df.query()` 进行查询。   |
| **过滤** | 使用 `WHERE` 子句进行条件过滤。         | 通过布尔索引或 `.query()` 实现。             |
| **排序** | 使用 `ORDER BY` 对结果排序。            | 使用 `df.sort_values()`。                    |
| **聚合** | 使用聚合函数（如 `COUNT()`、`SUM()`）。 | 使用 `groupby().agg()`。                     |
| **分组** | 使用 `GROUP BY` 语句。                  | 使用 `df.groupby()`。                        |
| **连接** | 使用 `JOIN` 合并多张表。                | 使用 `pd.merge()`。                          |
| **更新** | 使用 `UPDATE` 修改表中的数据。          | 直接对 `DataFrame` 修改值，例如 `df.loc[]`。 |
| **删除** | 使用 `DELETE` 删除表中的行。            | 使用 `df.drop()` 删除行或列。                |

------

### **3. 语言与接口**

| 特性       | SQL                                                | pandas                                  |
| ---------- | -------------------------------------------------- | --------------------------------------- |
| **语言**   | 专门的查询语言（如 SQL 标准、MySQL、PostgreSQL）。 | Python 的数据操作库。                   |
| **语法**   | 声明式，代码更接近自然语言。                       | 编程式，需要熟悉 Python 和 pandas API。 |
| **灵活性** | 专注于数据库操作，主要用于 CRUD。                  | 适合复杂的数据分析和操作流程。          |

------

### **4. 性能**

| 特性           | SQL                                    | pandas                                                      |
| -------------- | -------------------------------------- | ----------------------------------------------------------- |
| **大数据处理** | 设计用于处理大规模数据（TB 级别）。    | 适合中小规模数据处理（GB 级别），可结合 Dask 处理更大数据。 |
| **索引优化**   | 数据库支持索引，可以大幅提升查询性能。 | pandas 也支持索引，但依赖内存，性能不如数据库。             |
| **并发性**     | 支持多用户并发操作。                   | 主要用于单用户操作，适合个人数据分析任务。                  |

------

### **5. 聚合与分组**

| 特性           | SQL                                    | pandas                                             |
| -------------- | -------------------------------------- | -------------------------------------------------- |
| **单列聚合**   | 使用 `SELECT SUM(column) FROM table`。 | 使用 `df['column'].sum()`。                        |
| **分组聚合**   | 使用 `GROUP BY column`。               | 使用 `df.groupby('column').agg() 或 transform()`。 |
| **自定义聚合** | 较麻烦，需要编写存储过程或扩展函数。   | 非常灵活，支持自定义函数直接传递给 `agg()`。       |

------

### **6. 合并数据**

| 特性         | SQL                                             | pandas                                    |
| ------------ | ----------------------------------------------- | ----------------------------------------- |
| **连接方式** | 使用 `JOIN`（INNER、LEFT、RIGHT、FULL OUTER）。 | 使用 `pd.merge()`（支持同样的连接方式）。 |
| **多表连接** | 支持复杂的多表连接操作。                        | 需要多次 `merge` 实现。                   |
| **跨表操作** | 支持子查询和视图。                              | 可通过合并后的 `DataFrame` 实现类似效果。 |

------

### **7. 数据清洗**

| 特性           | SQL                                              | pandas                                                |
| -------------- | ------------------------------------------------ | ----------------------------------------------------- |
| **缺失值处理** | 使用 `NULL` 和函数（如 `COALESCE()`）。          | 使用 `df.fillna()`、`df.dropna()`。                   |
| **列操作**     | 使用 `ALTER TABLE` 添加或删除列。                | 直接操作 `DataFrame` 列（如 `df['new_col'] = ...`）。 |
| **字符串操作** | 依赖字符串函数（如 `SUBSTRING()`、`CONCAT()`）。 | 使用 `df['col'].str` 的方法，例如 `str.contains()`。  |
| **日期操作**   | 依赖日期函数（如 `DATEADD()`、`DATEDIFF()`）。   | 使用 pandas 的 `pd.to_datetime()` 和日期处理方法。    |

------

### **8. 使用场景**

| 场景                     | SQL                                                | pandas                                       |
| ------------------------ | -------------------------------------------------- | -------------------------------------------- |
| **大规模数据存储与操作** | SQL 是关系型数据库管理的核心工具，适合大数据分析。 | 适合中小规模数据操作，更灵活处理细节。       |
| **数据清洗与预处理**     | 支持简单的数据清洗和转换。                         | 功能强大，适合复杂的清洗任务。               |
| **复杂分析与建模**       | 主要侧重数据的聚合和查询，不擅长建模和复杂分析。   | 内置许多分析工具，能与机器学习框架无缝集成。 |

------

### **9. 结合使用**

在现代数据工作流中，SQL 和 pandas 常常结合使用：

1. **SQL**：用于从数据库提取数据，完成基础的过滤、分组和聚合。
2. **pandas**：用于提取后的数据处理、清洗、分析和可视化。

例如：

```python
import pandas as pd
import sqlalchemy

# 从 SQL 数据库提取数据
engine = sqlalchemy.create_engine('mysql+pymysql://user:password@host/dbname')
query = "SELECT * FROM table WHERE column > 100"
df = pd.read_sql(query, engine)

# 使用 pandas 处理提取的数据
df['new_col'] = df['existing_col'] * 2
result = df.groupby('group_col').agg({'new_col': 'sum'})
print(result)
```

------

### **总结**

| 对比点           | SQL                              | pandas                 |
| ---------------- | -------------------------------- | ---------------------- |
| **擅长领域**     | 数据库查询与管理、大规模数据处理 | 数据分析、清洗与建模   |
| **适用数据规模** | TB 级别及以上                    | GB 级别或更小          |
| **执行位置**     | 数据存储于数据库                 | 数据加载到内存         |
| **扩展性**       | 通过存储过程、触发器扩展         | 结合 Python 库灵活扩展 |

根据任务需求选择工具，或结合两者以实现高效工作流！
