# 分布式锁



满足分布式系统或集群模式下多进程可见并且互斥的锁。

- 多进场可见
- 互斥
- 高可用
- 高性能
- 安全性
- 锁自身的特性：公平非公平等



三种常见方式对比：

![截屏2023-02-08 11.12.18](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/3978/%E6%88%AA%E5%B1%8F2023-02-08%2011.12.18.png)





### Redis实现



```redis
# 添加锁，NX是互斥，EX是超时时间
SET lock thread1 EX 10 NX
```





存在问题：

1. 设置超时时间



![截屏2023-02-08 13.10.05](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/3978/%E6%88%AA%E5%B1%8F2023-02-08%2013.10.05.png)





缺点：

- 不可重入

  同一个线程无法多次获取同一把锁

- 不可重试

  获取锁只尝试一次就返回false

- 超时释放

  

- 主从一致性问题

  



