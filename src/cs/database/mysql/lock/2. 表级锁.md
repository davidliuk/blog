# 表级锁

每次操作锁住整张表。锁定粒度大，发生锁冲突的概率最高，并发度最低。应用在MyISAM、InnoDB、BDB



### 分类

对于表级锁，主要分为以下三类：

- 表锁
- 元数据锁（MDL）
- 意向锁



### 表锁

对于表锁，分为两类：

1. 表共享读锁（read lock）

   加锁以后可以自己读，但是不可以写（会拒绝执行）

   不会阻塞其他客户端的读，会阻塞其他客户端的写

2. 表独占写锁（write lock）

   加锁以后自己可以读写

   但是会阻塞别的客户端的读写



语法

1. 加锁：

   `lock tables <表名, ...> read/write`

2. 释放锁：
   - `unlock tables`
   - 客户端断开连接



### 元数据锁（MDL）

目的：避免执行DML和DDL语句的冲突问题。

不用手动加，加锁过程是系统自动控制，无需显示使用，在访问一张表的时候会自动加上。

- 对一张表进行 CRUD 操作时，加的是 **MDL 读锁**；
- 对一张表做结构变更操作（DDL）的时候，加的是 **MDL 写锁**；

MDL 是为了保证当用户对表执行 CRUD 操作时，防止其他线程对这个表结构做了变更。



### 意向锁

目的：规避行锁和表锁之间在加锁时的冲突问题，避免表锁在加锁的时候逐行地去检查这张表行锁的情况。

不用手动加，是系统自动控制

- 意向共享锁 IS

  与表锁共享锁（read）兼容，与表锁排他锁互斥

- 意向排他锁 IX

  

意向锁之间不互斥





### AUTO-INC 锁

目的：实现主键自增