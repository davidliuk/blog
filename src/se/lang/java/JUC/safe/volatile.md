# volatile



### 可见性

会直接向主存中存取

JIT有的时候会优化，对执行过多的重点语句，有些就从物理内存中抽出来弄成一个局部的了，这样就会造成后续对这个变量改变对这句话不可见，如果给这个变量加volatile，就不会被优化，可以保证可见性。





### 有序性

内存屏障：

- 对volatile变量写操作之前有向上的内存屏障，防止前面的语句越过屏障
- 对volatile变量读操作之后有向下的内存屏障，防止后面的语句越过屏障



写变量，一定要让volatile变量在最下面；

读变量，一定在最上面

这样才可以保证有序性

