# 3. Shell 编程

（Linux 课讲的是系统编程不是 shell）

### 基本

1. \#是注释

shell 脚本的第一行

文件的前 16 个 bit（前两个字节/英文字符）是 magic number，

来说明是啥，然后用后面的东西解释（sh 可以 ls 也可以，都行，但是能做的内容不一样多）

> ”符号链接“待会讲

```sh
#!/bin/sh

```

ll 是 alias：ls -l

执行方法：

- sh 名字

- Chmod -x 增加可执行权限

脚本语言里面，变量基本上不需要声明类型，直接=赋值即可

shell 里面变量只有一种类型，就是字符串

shell 里面变量名称喜欢全大写，

连续的字符串可以 省略引号，但是如果有括号，就必须要单引号、双引号

变量引用，就是在变量名前面+\$符号

```sh
$HELLO
${HELLO}
${HELLO:3:4} #完整版，取3到4
${HELLO::4} #可以随意缺省部分
${HELLO:3}
```

特殊变量

```sh
$# #传入的参数个数
$0 #sh脚本的名
$1 #就是输入的第一个参数
$? #The status of last CMD上一个命令的返回值（成功是0，失败是1等）
```

字符串（变量值）拼接，直接 echo 后面变量挨着写即可

变量默认值（常用于取不一定设置的环境变量时）

```sh
${COLOR:-green} #无的时候用-后面替换
${COLOR:=green} #无的时候用=后面替换，且将这个变量赋值，如果有则不赋值
```

env 是 set 的子集

ps 看进程

export 可以把 set 里面的变量升级为环境变量

环境变量：可以通过父进程传递给子进程的

```sh
PATH=.:$PATH #就是加上这个"."#当前目录
恢复的话就是，PATH=${PATH:2}
```

su 命令只切换目录，但是不切换环境；su -就可以同时切换到目标用户的环境

有空格分割的话，for each 的时候就相当于数组

### 条件测试

分支

测试工具主要就是\$?

其实就是在运行一些命令（实际上并不是在变成）

0-255，只用了 8 个 bit

shell 里面 0 是真，其他都是假（与 C 相反）

权限测试语句

- test -w 文件名，测试他的执行权限
- `[ -w a.c ]`方括号语法，注意空格一个都不能差，不然报错

字符串测试

- !=
- =

数字测试

- gt
- lt
- ne
- eq

## 循环语句

### foreach

### 命令替换：

- \`ls\`
- \$(ls)

### for

### while & until loop

执行数学运算$((1+1))

if

case

## I/O

echo

read，读取用户输入的字符

tee 可以把命令的流分成两叉，常用在既把输出到文件又输出他

## 重定向

`>`：覆盖原有内容

`>>`：写在末尾

## 引号

' '只是当做字符串

" "可以转义里面的变量或者公式进行输出

\` \`命令替换

## 函数

想要获取输入的参数就用，\$1, \$2 等

返回值，在 0-255 之间，但是

include：.

随机数

```sh
cat /dev/urandom | od -N2 -An -i | awk -v f=1 -v r=100 '{printf "%i\n", f + r * $1 / 65536}'
```

这条命令的作用是生成一个在给定范围内随机分布的整数。

具体原理如下：

cat /dev/urandom：/dev/urandom 是 Linux 系统中的一个特殊设备文件，可以读取其内容来获取伪随机数。cat 命令用于将 /dev/urandom 的内容输出到标准输出。
od -N2 -An -i：od 命令用于将二进制数据转换为不同的格式进行展示。-N2 表示只读取两个字节，-An 表示不输出地址，-i 表示将字节解析为整数。
`awk -v f=1 -v r=100 '{printf "%i\n", f + r * $1 / 65536}'`：这部分利用 awk 命令对输入进行处理。首先，-v f=1 和 -v r=100 分别定义了 awk 的变量 f 和 r，分别表示范围的起始值和区间长度。然后，{printf "%i\n", f + r * $1 / 65536} 用于计算并输出在给定范围内的随机整数。其中，$1 表示 awk 的第一个输入字段，即前一步 od 命令输出的整数，65536 是一个常数，用于将取值范围归一化到 0~1 之间，然后利用乘法和加法操作将其映射到给定的范围内。
综合起来，这条命令的原理是从 /dev/urandom 中读取随机字节，然后通过 od 命令转换为整数，并通过 awk 命令将这些整数映射到给定的范围内，生成随机分布的整数。
