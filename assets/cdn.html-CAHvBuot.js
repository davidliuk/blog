import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as i,o as a}from"./app-TGRQBxvj.js";const o={};function r(l,e){return a(),n("div",null,e[0]||(e[0]=[i('<h1 id="cdn" tabindex="-1"><a class="header-anchor" href="#cdn"><span>CDN</span></a></h1><p>Cloudflare</p><p>流量分流：Wireguard</p><h2 id="什么是-cdn" tabindex="-1"><a class="header-anchor" href="#什么是-cdn"><span>什么是 CDN ？</span></a></h2><p><strong>CDN</strong> 全称是 Content Delivery Network/Content Distribution Network，翻译过的意思是 <strong>内容分发网络</strong> 。</p><p>我们可以将内容分发网络拆开来看：</p><ul><li>内容：指的是静态资源比如图片、视频、文档、JS、CSS、HTML。</li><li>分发网络：指的是将这些静态资源分发到位于多个不同的地理位置机房中的服务器上，这样，就可以实现静态资源的就近访问比如北京的用户直接访问北京机房的数据。</li></ul><p>所以，简单来说，<strong>CDN 就是将静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。</strong></p><p>类似于京东建立的庞大的仓储运输体系，京东物流在全国拥有非常多的仓库，仓储网络几乎覆盖全国所有区县。这样的话，用户下单的第一时间，商品就从距离用户最近的仓库，直接发往对应的配送站，再由京东小哥送到你家。</p><p>你可以将 CDN 看作是服务上一层的特殊缓存服务，分布在全国各地，主要用来处理静态资源的请求。</p><p>我们经常拿全站加速和内容分发网络做对比，不要把两者搞混了！全站加速（不同云服务商叫法不同，腾讯云叫 ECDN、阿里云叫 DCDN）既可以加速静态资源又可以加速动态资源，内容分发网络（CDN）主要针对的是 <strong>静态资源</strong> 。</p><p><img src="https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-aliyun-dcdn.png" alt="阿里云文档：https://help.aliyun.com/document_detail/64836.html" loading="lazy"></p><p>绝大部分公司都会在项目开发中使用 CDN 服务，但很少会有自建 CDN 服务的公司。基于成本、稳定性和易用性考虑，建议直接选择专业的云厂商（比如阿里云、腾讯云、华为云、青云）或者 CDN 厂商（比如网宿、蓝汛）提供的开箱即用的 CDN 服务。</p><p>很多朋友可能要问了：<strong>既然是就近访问，为什么不直接将服务部署在多个不同的地方呢？</strong></p><ul><li>成本太高，需要部署多份相同的服务。</li><li>静态资源通常占用空间比较大且经常会被访问到，如果直接使用服务器或者缓存来处理静态资源请求的话，对系统资源消耗非常大，可能会影响到系统其他服务的正常运行。</li></ul><p>同一个服务在在多个不同的地方部署多份（比如同城灾备、异地灾备、同城多活、异地多活）是为了实现系统的高可用而不是就近访问。</p><h2 id="工作原理" tabindex="-1"><a class="header-anchor" href="#工作原理"><span>工作原理</span></a></h2><p>搞懂下面 3 个问题也就搞懂了 CDN 的工作原理：</p><ol><li>静态资源是如何被缓存到 CDN 节点中的？</li><li>如何找到最合适的 CDN 节点？</li><li>如何防止静态资源被盗用？</li></ol><h3 id="静态资源是如何被缓存" tabindex="-1"><a class="header-anchor" href="#静态资源是如何被缓存"><span>[静态资源是如何被缓存</span></a></h3><p>你可以通过 <strong>预热</strong> 的方式将源站的资源同步到 CDN 的节点中。这样的话，用户首次请求资源可以直接从 CDN 节点中取，无需回源。这样可以降低源站压力，提升用户体验。</p><p>如果不预热的话，你访问的资源可能不在 CDN 节点中，这个时候 CDN 节点将请求源站获取资源，这个过程是大家经常说的 <strong>回源</strong>。</p><ul><li>回源：当 CDN 节点上没有用户请求的资源或该资源的缓存已经过期时，CDN 节点需要从原始服务器获取最新的资源内容，这个过程就是回源。当用户请求发生回源的话，会导致该请求的响应速度比未使用 CDN 还慢，因为相比于未使用 CDN 还多了一层 CDN 的调用流程。</li><li>预热：预热是指在 CDN 上提前将内容缓存到 CDN 节点上。这样当用户在请求这些资源时，能够快速地从最近的 CDN 节点获取到而不需要回源，进而减少了对源站的访问压力，提高了访问速度。</li></ul><p>如果资源有更新的话，你也可以对其 <strong>刷新</strong> ，删除 CDN 节点上缓存的旧资源，并强制 CDN 节点回源站获取最新资源。</p><p>几乎所有云厂商提供的 CDN 服务都具备缓存的刷新和预热功能（下图是阿里云 CDN 服务提供的相应功能）：</p><p><strong>命中率</strong> 和 <strong>回源率</strong> 是衡量 CDN 服务质量两个重要指标。命中率越高越好，回源率越低越好。</p><h3 id="如何找到最合适的-cdn-节点" tabindex="-1"><a class="header-anchor" href="#如何找到最合适的-cdn-节点"><span><a href="https://javaguide.cn/high-performance/cdn.html#%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E6%9C%80%E5%90%88%E9%80%82%E7%9A%84-cdn-%E8%8A%82%E7%82%B9" target="_blank" rel="noopener noreferrer">如何找到最合适的 CDN 节点？</a></span></a></h3><p>GSLB （Global Server Load Balance，全局负载均衡）是 CDN 的大脑，负责多个 CDN 节点之间相互协作，最常用的是基于 DNS 的 GSLB。</p><p>CDN 会通过 GSLB 找到最合适的 CDN 节点，更具体点来说是下面这样的：</p><ol><li>浏览器向 DNS 服务器发送域名请求；</li><li>DNS 服务器向根据 CNAME( Canonical Name ) 别名记录向 GSLB 发送请求；</li><li>GSLB 返回性能最好（通常距离请求地址最近）的 CDN 节点（边缘服务器，真正缓存内容的地方）的地址给浏览器；</li><li>浏览器直接访问指定的 CDN 节点。</li></ol><p>为了方便理解，上图其实做了一点简化。GSLB 内部可以看作是 CDN 专用 DNS 服务器和负载均衡系统组合。CDN 专用 DNS 服务器会返回负载均衡系统 IP 地址给浏览器，浏览器使用 IP 地址请求负载均衡系统进而找到对应的 CDN 节点。</p><p><strong>GSLB 是如何选择出最合适的 CDN 节点呢？</strong> GSLB 会根据请求的 IP 地址、CDN 节点状态（比如负载情况、性能、响应时间、带宽）等指标来综合判断具体返回哪一个 CDN 节点的地址。</p>',32)]))}const d=t(o,[["render",r],["__file","cdn.html.vue"]]),s=JSON.parse(`{"path":"/cs/basic/network/application/cdn.html","title":"CDN","lang":"en-US","frontmatter":{"description":"CDN Cloudflare 流量分流：Wireguard 什么是 CDN ？ CDN 全称是 Content Delivery Network/Content Distribution Network，翻译过的意思是 内容分发网络 。 我们可以将内容分发网络拆开来看： 内容：指的是静态资源比如图片、视频、文档、JS、CSS、HTML。 分发网络：指的...","head":[["meta",{"property":"og:url","content":"https://davidliuk.github.io/blog/blog/cs/basic/network/application/cdn.html"}],["meta",{"property":"og:site_name","content":"David's Blog"}],["meta",{"property":"og:title","content":"CDN"}],["meta",{"property":"og:description","content":"CDN Cloudflare 流量分流：Wireguard 什么是 CDN ？ CDN 全称是 Content Delivery Network/Content Distribution Network，翻译过的意思是 内容分发网络 。 我们可以将内容分发网络拆开来看： 内容：指的是静态资源比如图片、视频、文档、JS、CSS、HTML。 分发网络：指的..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-aliyun-dcdn.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-11T05:08:21.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-11T05:08:21.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CDN\\",\\"image\\":[\\"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-aliyun-dcdn.png\\"],\\"dateModified\\":\\"2025-12-11T05:08:21.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"David Liu\\",\\"url\\":\\"https://github.com/davidliuk\\"}]}"]]},"headers":[{"level":2,"title":"什么是 CDN ？","slug":"什么是-cdn","link":"#什么是-cdn","children":[]},{"level":2,"title":"工作原理","slug":"工作原理","link":"#工作原理","children":[{"level":3,"title":"[静态资源是如何被缓存","slug":"静态资源是如何被缓存","link":"#静态资源是如何被缓存","children":[]},{"level":3,"title":"如何找到最合适的 CDN 节点？","slug":"如何找到最合适的-cdn-节点","link":"#如何找到最合适的-cdn-节点","children":[]}]}],"git":{"createdTime":1700646963000,"updatedTime":1765429701000,"contributors":[{"name":"David Liu","email":"davidliu02k@gmail.com","commits":1},{"name":"刘大维","email":"davidliu@liudaweideMacBook-Pro.local","commits":1}]},"readingTime":{"minutes":5.07,"words":1521},"filePathRelative":"cs/basic/network/application/cdn.md","localizedDate":"November 22, 2023","excerpt":"\\n<p>Cloudflare</p>\\n<p>流量分流：Wireguard</p>\\n<h2>什么是 CDN ？</h2>\\n<p><strong>CDN</strong> 全称是 Content Delivery Network/Content Distribution Network，翻译过的意思是 <strong>内容分发网络</strong> 。</p>\\n<p>我们可以将内容分发网络拆开来看：</p>\\n<ul>\\n<li>内容：指的是静态资源比如图片、视频、文档、JS、CSS、HTML。</li>\\n<li>分发网络：指的是将这些静态资源分发到位于多个不同的地理位置机房中的服务器上，这样，就可以实现静态资源的就近访问比如北京的用户直接访问北京机房的数据。</li>\\n</ul>","autoDesc":true}`);export{d as comp,s as data};
