import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as p,a as l,o as a}from"./app-DQpqR3jB.js";const t={};function o(n,e){return a(),p("div",null,e[0]||(e[0]=[l('<h1 id="æ¥å£è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#æ¥å£è®¾è®¡"><span>æ¥å£è®¾è®¡</span></a></h1><p>ç½‘ç«™ç³»ç»Ÿï¼ŒAPIè®¾è®¡ä¸çŸ­ç½‘å€Web System,API, Design Tiny URL</p><p>Â·ç½‘ç«™ç³»ç»Ÿçš„åŸºæœ¬æ„æˆ<br> Â·APIè®¾è®¡é—®é¢˜<br> Â·ä»€ä¹ˆæ˜¯RestAPI</p><p>å®æˆ˜çœŸé¢˜ï¼š</p><p>a.What happend if you visit <a href="http://www.google.com" target="_blank" rel="noopener noreferrer">www.google.com</a>?<br> b.How to design tiny url?<br> c.å¦‚ä½•è®¾è®¡News Feed API<br> d.å¦‚ä½•è®¾è®¡mentionåŠŸèƒ½<br> e.å¦‚ä½•åšç¿»é¡µPagination</p><p>å…³é”®è¯ï¼šWeb,Consistent Hashing,Memcached,Tiny url..</p><h2 id="rest-api" tabindex="-1"><a class="header-anchor" href="#rest-api"><span>Rest API</span></a></h2><p>ä½ è¦è·å–çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Œä½ çš„è·¯å¾„å°±æ˜¯ä»€ä¹ˆå¼€å¤´çš„</p><ul><li>æ¯ä¸ªURLä»£è¡¨æŸç±»æ•°æ®/èµ„æº</li><li>HTTPçš„å››ä¸ªåŠ¨ä½œï¼Œä»£è¡¨æ•°æ®çš„å¢åˆ æ”¹æŸ¥</li><li>æ‰€æœ‰ç­›é€‰æ¡ä»¶ï¼Œåˆ›å»ºå‚æ•°ï¼Œæ”¾åˆ°HTTPçš„å‚æ•°é‡Œé¢</li></ul><p>è½¬è´¦API</p><p><code>POST /api/transaction/?from=1&amp;to=2&amp;money=500</code></p><h2 id="design-news-feed-api" tabindex="-1"><a class="header-anchor" href="#design-news-feed-api"><span>Design News Feed API</span></a></h2><p>è®¾è®¡å‰åç«¯çš„äº¤äº’æ¥å£</p><ul><li><p>ä»€ä¹ˆæ˜¯APIï¼ŒWeb APIè¯·æ±‚æ ¼å¼</p><p><code>GET api.domain.com/newsfeed/</code></p><p><code>GET domain.com/api/newsfeed/</code></p></li><li><p>è¿”å›å†…å®¹æ ¼å¼</p><p>Structured Dataï¼šjsonæˆ–xmlï¼Œä¸»è¦æ˜¯json</p><p>xmlä¸»è¦åœ¨androidçš„ä»£ç ä¸­ç”¨äºè®°å½•ä¸€äº›æ ¼å¼åŒ–æ•°æ®</p></li><li><p>è®¾è®¡Pagination</p><ul><li><p><code>page=1</code>,</p><p>ä¼˜ç‚¹ï¼šå¯ä»¥è·³è½¬åˆ°ç¬¬xé¡µ</p><p>ç¼ºç‚¹ï¼šå¦‚æœæœ‰æ–°çš„æ•°æ®æ’å…¥ï¼Œåˆ™ç¿»é¡µçš„æ—¶å€™å¯èƒ½çœ‹åˆ°ä¸Šä¸€é¡µçš„å†…å®¹ï¼Œåˆ·æ–°æ¯”è¾ƒéš¾å—</p></li><li><p><code>max_id=xxx</code>, cursor æ³•ï¼Œä¿¡æ¯æµå˜åŒ–å¿«çš„</p><p>æ²¡æœ‰max_idè¡¨ç¤ºç¬¬ä¸€é¡µ</p><p>æœ‰max_idæ‰¾æ‰€æœ‰id&lt;=max_idçš„æœ€é¡¶ä¸Šçš„20ä¸ªï¼ˆæ—¶é—´å€’å™æ’åˆ—ï¼‰</p><ul><li>å¦‚ä½•åˆ¤æ–­æœ‰æ²¡æœ‰ä¸‹ä¸€é¡µï¼Œå¦‚æœé¿å…é¢å¤–å†æŸ¥ä¸€æ¬¡æ¥åˆ¤æ–­æ˜¯å¦ç»ˆç‚¹ <ul><li>Next_max_idï¼Œæ¯æ¬¡å¤šæ‰¾ä¸€ä¸ªæ•°æ®ï¼ŒæŠŠè¿™ä¸ªæ•°æ®çš„idä½œä¸ºnext_max_id</li></ul></li></ul></li></ul></li><li><p>è®¾è®¡Mentionsçš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥ç‚¹è¿›äººå®¶çš„ä¸»é¡µé‡Œé¢</p></li></ul><h2 id="mentions-æ•°æ®æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#mentions-æ•°æ®æ ¼å¼"><span>Mentions æ•°æ®æ ¼å¼</span></a></h2><p>é¢„é˜² Javascript injection attack</p><p>mobileå’Œwebä¸èƒ½å…±äº«</p><p>urlå¯èƒ½æ”¹åŠ¨</p><p>æ¨èæ–¹æ³•ï¼š</p><p>è‡ªå®šä¹‰é“¾æ¥ç»“æ„</p><p>å¦‚ï¼š<code>&lt;user username=&quot;a&quot;&gt;Hello World&lt;/user&gt;</code>è®©Webå’ŒMobileåˆ†åˆ«å¯¹è¯¥æ ¼å¼è¿›è¡Œè§£æ</p><h2 id="çŸ­é“¾æ¥ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#çŸ­é“¾æ¥ç³»ç»Ÿ"><span>çŸ­é“¾æ¥ç³»ç»Ÿ</span></a></h2><ol><li>æé—®ï¼šåˆ†æåŠŸèƒ½</li><li>ç”»å›¾ï¼š</li></ol><h3 id="scenario" tabindex="-1"><a class="header-anchor" href="#scenario"><span>Scenario</span></a></h3><p>Long Urlå’ŒShort Urlä¹‹é—´å¿…é¡»æ˜¯ä¸€ä¸€å¯¹åº”å˜›ï¼Ÿshortåªå¯¹åº”ä¸€ä¸ªlongï¼Œä½†æ˜¯ä¸€ä¸ªlongå¯èƒ½å¤šä¸ªä¹Ÿå¯èƒ½ä¸€ä¸ªshortï¼Œä½†æ˜¯å¯¹åº”ä¸€ä¸ªshortæ¯”è¾ƒçœç©ºé—´</p><p>Short Urlé•¿æ—¶é—´æ˜¯å¦éœ€è¦é‡Šæ”¾ï¼šè§‰å¾—æœ€å¥½ä¸è¦é‡Šæ”¾</p><p>QPSæ–°æµªå¾®åš</p><p>DAU 100M</p><p>QPS 100M*0.1/86400 =100</p><p>Peek Write QPS=100*2=200</p><p>Read QPS 100M*0.1/86400 =100</p><p>Peak Read QPS=2kï¼Œä¸€å°SSDçš„MySQLå®Œå…¨å¯ä»¥æå®š</p><p>Storage</p><p>100M*0.1=10M</p><p>é•¿åº¦100ç®—ï¼Œ1G</p><p>1Tç¡¬ç›˜ç”¨3å¹´</p><h3 id="service" tabindex="-1"><a class="header-anchor" href="#service"><span>Service</span></a></h3><p>GET 301</p><p>POST 200</p><h3 id="strorage-ğŸŒŸ" tabindex="-1"><a class="header-anchor" href="#strorage-ğŸŒŸ"><span>Strorage ğŸŒŸ</span></a></h3><ol><li>Select</li><li>Schema</li></ol><p>SQL or NoSQL</p><p>Transaction? ä¸éœ€è¦ã€‚NoSQL+1</p><p>ä¸°å¯ŒSQL Queryï¼Ÿä¸éœ€è¦ã€‚NoSQL+1</p><p>æ˜¯å¦å·æ‡’ï¼ŸTinyURLå†™èµ·æ¥ä¸å¤æ‚ï¼ŒNoSQL+1</p><p>QPSé«˜ä¸ï¼Ÿä¸ï¼ŒSQL+1</p><p>Scalabilityï¼Ÿä¸é«˜ï¼ŒSQL+1</p><p><strong>Sequential ID</strong>ï¼Ÿå–å†³äºä½ ç”¨çš„ç®—æ³•</p><ul><li>SQLæœ‰auto- incrementçš„Sequential ID</li><li>NoSQLçš„IDå¹¶ä¸æ˜¯Sequentialçš„</li></ul><p>ç®—æ³•1:hash Functionï¼ˆä¸å¯è¡Œï¼‰</p><p>Long Urlçš„MD5çš„å6ä½</p><p>ä¼˜ç‚¹ï¼šå¿«</p><p>ç¼ºç‚¹ï¼šéš¾ä»¥è®¾è®¡ä¸å†²çªçš„hash</p><p>ç®—æ³•2: éšæœºç”ŸæˆShortURL+æ•°æ®åº“å»é‡</p><p>ä¼˜ç‚¹ï¼šç®€å•</p><p>ç¼ºç‚¹ï¼šç”Ÿäº§ç½‘å€è¶Šå¤šï¼Œä¹‹åç”Ÿäº§è¶Šæ…¢</p><p><strong>ç®—æ³•3: è¿›åˆ¶è½¬æ¢ Base62</strong></p><p>å°†6ä½çš„short urlçœ‹ä½œ62è¿›åˆ¶æ•°ï¼ˆ0-9, a-z, A-Z)</p><p>æ¯ä¸ªshort URLå¯¹åº”åˆ°ä¸€ä¸ªæ•´æ•°</p><p>è¯¥æ•´æ•°å¯¹åº”æ•°æ®åº“è¡¨çš„Primay Key</p><p>6ä½ï¼Œ570äº¿</p><p>ä¼˜ç‚¹ï¼šæ•ˆç‡é«˜ï¼Œç¨³å®š</p><p>ç¼ºç‚¹ï¼šä¾èµ–å…¨å±€çš„è‡ªå¢IDï¼Œå¯ä»¥è¢«æš´åŠ›æšä¸¾ï¼Œä½†æ˜¯è¿™ä¸ªæ²¡å•¥äº‹ï¼Œä¸æ˜¯ä»€ä¹ˆæœºå¯†æ•°æ®</p><p>Schema</p><p><code>ID</code>, <code>long URL</code></p><p>Indexï¼Œæ”¯æŒåå‘æŸ¥æ‰¾</p><h3 id="scale" tabindex="-1"><a class="header-anchor" href="#scale"><span>Scale</span></a></h3><p>reduce response time</p><ol><li><p>Cache Aside</p><p>Memcached: long to short, short to long</p></li><li><p>åˆ©ç”¨åœ°ç†ä½ç½®æé€Ÿ</p><ol><li><p>ä¸åŒåœ°åŒºä¸åŒweb server</p><p>memcachedåˆ†åŒºï¼Œdbå…±äº«ï¼ŒæœåŠ¡å™¨ä¹‹é—´å¯ä»¥åšé“¾è·¯ä¼˜åŒ–ï¼Œæ¯”è¾ƒå¿«</p></li><li><p>DNSè§£æä¸åŒåœ°åŒº</p></li></ol></li></ol><p>how to scale</p><ul><li>cacheä¸å¤Ÿ</li><li>å†™æ“ä½œå˜å¤š</li></ul><p>Vertical Sharding: ä¸è¡Œï¼Œå°±ä¸¤ä¸ªå­—æ®µ</p><p>Horizontal Sharding</p><ul><li>ID/short URLåšsharding key <ul><li>long to shortæŸ¥è¯¢çš„æ—¶å€™åªèƒ½å¹¿æ’­ç»™Nå°æ•°æ®åº“æŸ¥è¯¢</li><li>ä¸ºä»€ä¹ˆlong to shortï¼Ÿé¿å…é‡å¤çš„æ—¶å€™ä¼šæŸ¥ï¼Œ</li><li>å¦‚æœä¸éœ€è¦å»é‡åˆ™è¿™ç§æ–¹æ¡ˆå¯è¡Œ</li></ul></li><li>Long URLåšsharding key <ul><li>short to long æŸ¥è¯¢çš„æ—¶å€™ï¼Œåªèƒ½å¹¿æ’­Nå°</li><li>ä½†æ˜¯è¿™ä¸ªshort to longæ˜¯æœ€å¸¸ç”¨éœ€æ±‚</li></ul></li></ul><p>å¤šå°æœºå™¨å¦‚ä½•ç»´æŠ¤å…¨å±€è‡ªå¢ID</p><ul><li>æ–¹æ¡ˆä¸€ï¼šä¸€å°æ•°æ®åº“ä¸“é—¨ç”¨æ¥åšè‡ªå¢IDæœåŠ¡ <ul><li>ä¸å­˜å‚¨çœŸå®æ•°æ®ï¼Œä¸ºé¿å…Single Point failureï¼Œéœ€è¦master slave</li></ul></li><li>æ–¹æ¡ˆäºŒï¼šzookeeper</li></ul><hr><p>custom url</p>',78)]))}const d=i(t,[["render",o],["__file","api.html.vue"]]),c=JSON.parse(`{"path":"/se/design/system/api.html","title":"æ¥å£è®¾è®¡","lang":"en-US","frontmatter":{"description":"æ¥å£è®¾è®¡ ç½‘ç«™ç³»ç»Ÿï¼ŒAPIè®¾è®¡ä¸çŸ­ç½‘å€Web System,API, Design Tiny URL Â·ç½‘ç«™ç³»ç»Ÿçš„åŸºæœ¬æ„æˆ Â·APIè®¾è®¡é—®é¢˜ Â·ä»€ä¹ˆæ˜¯RestAPI å®æˆ˜çœŸé¢˜ï¼š a.What happend if you visit www.google.com? b.How to design tiny url? c.å¦‚ä½•è®¾è®¡News Feed AP...","head":[["meta",{"property":"og:url","content":"https://davidliuk.github.io/blog/blog/se/design/system/api.html"}],["meta",{"property":"og:site_name","content":"David's Blog"}],["meta",{"property":"og:title","content":"æ¥å£è®¾è®¡"}],["meta",{"property":"og:description","content":"æ¥å£è®¾è®¡ ç½‘ç«™ç³»ç»Ÿï¼ŒAPIè®¾è®¡ä¸çŸ­ç½‘å€Web System,API, Design Tiny URL Â·ç½‘ç«™ç³»ç»Ÿçš„åŸºæœ¬æ„æˆ Â·APIè®¾è®¡é—®é¢˜ Â·ä»€ä¹ˆæ˜¯RestAPI å®æˆ˜çœŸé¢˜ï¼š a.What happend if you visit www.google.com? b.How to design tiny url? c.å¦‚ä½•è®¾è®¡News Feed AP..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-01-07T00:41:06.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-07T00:41:06.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"æ¥å£è®¾è®¡\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-01-07T00:41:06.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"David Liu\\",\\"url\\":\\"https://github.com/davidliuk\\"}]}"]]},"headers":[{"level":2,"title":"Rest API","slug":"rest-api","link":"#rest-api","children":[]},{"level":2,"title":"Design News Feed API","slug":"design-news-feed-api","link":"#design-news-feed-api","children":[]},{"level":2,"title":"Mentions æ•°æ®æ ¼å¼","slug":"mentions-æ•°æ®æ ¼å¼","link":"#mentions-æ•°æ®æ ¼å¼","children":[]},{"level":2,"title":"çŸ­é“¾æ¥ç³»ç»Ÿ","slug":"çŸ­é“¾æ¥ç³»ç»Ÿ","link":"#çŸ­é“¾æ¥ç³»ç»Ÿ","children":[{"level":3,"title":"Scenario","slug":"scenario","link":"#scenario","children":[]},{"level":3,"title":"Service","slug":"service","link":"#service","children":[]},{"level":3,"title":"Strorage ğŸŒŸ","slug":"strorage-ğŸŒŸ","link":"#strorage-ğŸŒŸ","children":[]},{"level":3,"title":"Scale","slug":"scale","link":"#scale","children":[]}]}],"git":{"createdTime":1715153702000,"updatedTime":1736210466000,"contributors":[{"name":"åˆ˜å¤§ç»´","email":"davidliu@liudaweideMacBook-Pro.local","commits":2},{"name":"åˆ˜å¤§ç»´","email":"davidliu@liudaweideMacBook-Pro-3.local","commits":1}]},"readingTime":{"minutes":3.45,"words":1034},"filePathRelative":"se/design/system/api.md","localizedDate":"May 8, 2024","excerpt":"\\n<p>ç½‘ç«™ç³»ç»Ÿï¼ŒAPIè®¾è®¡ä¸çŸ­ç½‘å€Web System,API, Design Tiny URL</p>\\n<p>Â·ç½‘ç«™ç³»ç»Ÿçš„åŸºæœ¬æ„æˆ<br>\\nÂ·APIè®¾è®¡é—®é¢˜<br>\\nÂ·ä»€ä¹ˆæ˜¯RestAPI</p>\\n<p>å®æˆ˜çœŸé¢˜ï¼š</p>\\n<p>a.What happend if you visit <a href=\\"http://www.google.com\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">www.google.com</a>?<br>\\nb.How to design tiny url?<br>\\nc.å¦‚ä½•è®¾è®¡News Feed API<br>\\nd.å¦‚ä½•è®¾è®¡mentionåŠŸèƒ½<br>\\ne.å¦‚ä½•åšç¿»é¡µPagination</p>","autoDesc":true}`);export{d as comp,c as data};
